"use strict";(self.webpackChunkFullStackSocialApp=self.webpackChunkFullStackSocialApp||[]).push([[667],{2667:(D,g,a)=>{a.r(g),a.d(g,{PublicationsModule:()=>L});var A=a(6424),P=a(5689),p=a(6895),t=a(1571),h=a(529),f=a(2843),s=a(5625),l=a(262);let y=(()=>{class i{constructor(e){this.http=e,this.basePath="https://fullstacksocialapp-api-lenco.onrender.com/api/v1/publications",this.httpOptions={headers:new h.WM({"Content-Type":"application/json"})}}handleError(e){return e.error instanceof ErrorEvent?console.log(`An error occurred: ${e.error.message} `):console.error(`Backend returned code ${e.status}, body was: ${e.error}`),(0,f._)(()=>new Error("Something happened with request, please try again later"))}getAll(){return this.http.get(this.basePath,this.httpOptions).pipe((0,s.X)(2),(0,l.K)(this.handleError))}create(e){return this.http.post(this.basePath,JSON.stringify(e),this.httpOptions).pipe((0,s.X)(2),(0,l.K)(this.handleError))}update(e,n){return this.http.put(`${this.basePath}/${e}`,JSON.stringify(n),this.httpOptions).pipe((0,s.X)(2),(0,l.K)(this.handleError))}delete(e){return this.http.delete(`${this.basePath}/${e}`,this.httpOptions).pipe((0,s.X)(2),(0,l.K)(this.handleError))}}return i.\u0275fac=function(e){return new(e||i)(t.LFG(h.eN))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var M=a(4961);let O=(()=>{class i{constructor(e){this.http=e,this.basePath="https://fullstacksocialapp-api-lenco.onrender.com/api/v1/publication_comments",this.httpOptions={headers:new h.WM({"Content-Type":"application/json"})}}handleError(e){return e.error instanceof ErrorEvent?console.log(`An error occurred: ${e.error.message} `):console.error(`Backend returned code ${e.status}, body was: ${e.error}`),(0,f._)(()=>new Error("Something happened with request, please try again later"))}getAll(){return this.http.get(this.basePath,this.httpOptions).pipe((0,s.X)(2),(0,l.K)(this.handleError))}getByPublicationId(e){return this.http.get(`${this.basePath}/getByPublicationId/${e}`,this.httpOptions).pipe((0,s.X)(2),(0,l.K)(this.handleError))}create(e){return this.http.post(this.basePath,JSON.stringify(e),this.httpOptions).pipe((0,s.X)(2),(0,l.K)(this.handleError))}update(e,n){return this.http.put(`${this.basePath}/${e}`,JSON.stringify(n),this.httpOptions).pipe((0,s.X)(2),(0,l.K)(this.handleError))}delete(e){return this.http.delete(`${this.basePath}/${e}`,this.httpOptions).pipe((0,s.X)(2),(0,l.K)(this.handleError))}deleteByPublicationId(e){return this.http.delete(`${this.basePath}/deleteByPublicationId/${e}`,this.httpOptions).pipe((0,s.X)(2),(0,l.K)(this.handleError))}deleteByLevel1(e){return this.http.delete(`${this.basePath}/deleteByLevel1/${e}`,this.httpOptions).pipe((0,s.X)(2),(0,l.K)(this.handleError))}deleteByLevel1AndLevel2(e,n){return this.http.delete(`${this.basePath}/deleteByLevel1AndLevel2/${e}/${n}`,this.httpOptions).pipe((0,s.X)(2),(0,l.K)(this.handleError))}deleteByLevel1AndLevel2AndLevel3(e,n,d){return this.http.delete(`${this.basePath}/deleteByLevel1AndLevel2/${e}/${n}/${d}`,this.httpOptions).pipe((0,s.X)(2),(0,l.K)(this.handleError))}}return i.\u0275fac=function(e){return new(e||i)(t.LFG(h.eN))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var w=a(9901),u=a(3546),E=a(9349),m=a(433),C=a(4859),b=a(6338),v=a(3162);function Z(i,c){1&i&&t._UZ(0,"mat-progress-bar",6)}function k(i,c){if(1&i&&(t.TgZ(0,"mat-list-item",25)(1,"div",26),t._UZ(2,"img",9),t.qZA(),t.TgZ(3,"div",27)(4,"div",28)(5,"div",29),t._uU(6),t.qZA(),t.TgZ(7,"div"),t._uU(8),t.qZA()(),t.TgZ(9,"div",30)(10,"div",11),t._uU(11),t.qZA()()()()),2&i){const e=c.$implicit;t.xp6(2),t.MGl("src","assets/img/",e.userAvatar,".png",t.LSH),t.s9C("alt",e.userAvatar),t.xp6(4),t.Oqu(e.username),t.xp6(2),t.Oqu(e.comment),t.xp6(3),t.Oqu(e.createdAt)}}function S(i,c){if(1&i){const e=t.EpF();t.TgZ(0,"mat-card",7)(1,"mat-card-header")(2,"mat-card-title",8),t._UZ(3,"img",9),t.TgZ(4,"div")(5,"div",10),t._uU(6),t.qZA(),t.TgZ(7,"div",11),t._uU(8),t.qZA()()()(),t._UZ(9,"br"),t.TgZ(10,"mat-card-content")(11,"div",12)(12,"div",13),t._uU(13),t.qZA()(),t._UZ(14,"div",14),t.TgZ(15,"div",15),t._uU(16,"Add a new comment"),t.qZA(),t.TgZ(17,"div")(18,"div",16)(19,"div",17)(20,"div",18)(21,"div",19)(22,"textarea",20),t.NdJ("ngModelChange",function(d){const r=t.CHM(e).$implicit,x=t.oxw();return t.KtG(x.comment[x.publicationsData.indexOf(r)]=d)}),t.qZA()()(),t.TgZ(23,"button",21),t.NdJ("click",function(){const o=t.CHM(e).$implicit,r=t.oxw();return t.KtG(r.addNewComment(r.publicationsData.indexOf(o),o.id))}),t._uU(24,"Comment"),t.qZA()()()(),t.TgZ(25,"mat-list",22)(26,"div",23),t._uU(27,"Comments"),t.qZA(),t.YNc(28,k,12,5,"mat-list-item",24),t.qZA()()()}if(2&i){const e=c.$implicit,n=t.oxw();t.xp6(3),t.MGl("src","assets/img/",e.userAvatar,".png",t.LSH),t.s9C("alt",e.userAvatar),t.xp6(3),t.Oqu(e.username),t.xp6(2),t.hij(" ",e.createdAt,""),t.xp6(5),t.hij(" ",e.content," "),t.xp6(9),t.Q6J("id","input"+e.id)("ngModel",n.comment[n.publicationsData.indexOf(e)]),t.xp6(1),t.Q6J("id","button"+e.id),t.xp6(5),t.Q6J("ngForOf",n.publicationCommentsArranged[n.publicationsData.indexOf(e)])}}let $=(()=>{class i{constructor(e,n,d,o){this.publicationsService=e,this.usersService=n,this.publicationCommentsService=d,this.elementRef=o,this.publicationsLoaded=!1,this.publicationCreate={},this.publicationCommentCreate={},this.comment=[],this.publicationsData=[],this.publicationCommentsArranged=[],this.publicationCommentsData=[]}ngOnInit(){this.retrievePublications(),this.socket=(0,P.ZP)("https://fullstacksocialappsocket-nodejs.onrender.com/"),this.socket.on("addNewPublicationComment",e=>{this.publicationCommentsArranged[this.publicationsData.findIndex(n=>n.id==e.publication)].push(e)}),this.socket.on("addNewPublication",e=>{this.publicationsData.push(e),this.publicationCommentsArranged.push([])})}ngAfterViewInit(){this.elementRef.nativeElement.ownerDocument.body.style.backgroundColor="#e0ecf4",document.getElementById("publicationContentAddTextarea").addEventListener("keyup",e=>{e.preventDefault(),"Enter"==e.key&&!e.shiftKey&&document.getElementById("publicationContentAddButton").click()})}retrievePublications(){this.publicationCommentsArranged=[],this.publicationsService.getAll().subscribe({next:e=>{this.publicationsData=e,this.publicationCommentsService.getAll().subscribe({next:n=>{this.publicationCommentsData=n,document.querySelectorAll("textarea").forEach(o=>{o.addEventListener("keydown",r=>{"Enter"==r.key&&!r.shiftKey&&r.preventDefault()})});for(let o of this.publicationsData)o.createdAt=(0,p.p6)(o.createdAt,"MMMM d, 'at' h:mm a","en-US"),this.publicationCommentsArranged.push(this.publicationCommentsData.filter(r=>r.publication==o.id)),document.getElementById("input"+o.id).addEventListener("keyup",r=>{r.preventDefault(),"Enter"==r.key&&!r.shiftKey&&document.getElementById("button"+o.id).click()});for(let o of this.publicationCommentsData)o.createdAt=(0,p.p6)(o.createdAt,"MMMM d, 'at' h:mm a","en-US");this.publicationsLoaded=!0}})}})}addNewPublication(){this.usersService.getUserPublicationByToken().subscribe({next:e=>{this.publicationCreate.userid=e.id,this.publicationCreate.userAvatar=e.avatar,this.publicationCreate.username=e.username,this.publicationsService.create(this.publicationCreate).subscribe({next:n=>{n.createdAt=(0,p.p6)(n.createdAt,"MMMM d, 'at' h:mm a","en-US"),this.publicationsData.push(n),this.publicationCreate={},this.socket.emit("addNewPublication",n),this.publicationCommentsArranged.push([])}})}})}addNewComment(e,n){let d=this.comment[e];null==d||""==d.replace(/\s/g,"")||(this.comment[e]="",this.usersService.getUserPublicationByToken().subscribe({next:o=>{this.publicationCommentCreate.userid=o.id,this.publicationCommentCreate.username=o.username,this.publicationCommentCreate.userAvatar=o.avatar,this.publicationCommentCreate.publication=n,this.publicationCommentCreate.comment=d,this.publicationCommentCreate.line=0,this.publicationCommentCreate.level=0,this.publicationCommentCreate.level1=0,this.publicationCommentCreate.level2=0,this.publicationCommentCreate.level3=0,this.publicationCommentsService.create(this.publicationCommentCreate).subscribe({next:r=>{r.createdAt=(0,p.p6)(r.createdAt,"MMMM d, 'at' h:mm a","en-US"),this.publicationCommentsArranged[e].push(r),this.publicationCommentCreate={},this.socket.emit("addNewPublicationComment",r)}})}}))}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(y),t.Y36(M.f),t.Y36(O),t.Y36(t.SBq))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-publications"]],decls:8,vars:3,consts:[["mode","indeterminate",4,"ngIf"],[2,"margin","0 auto","width","calc(min(450px,90%))"],[2,"width","calc(min(420px, calc(100% - 30px)))","margin-top","30px"],["id","publicationContentAddTextarea","cdkTextareaAutosize","","placeholder","Add a new publication here...",1,"comment-textarea",3,"ngModel","ngModelChange"],["id","publicationContentAddButton","mat-button","",3,"click"],["style","width: calc(min(450px,100%)); padding: 0; margin-top: 30px;",4,"ngFor","ngForOf"],["mode","indeterminate"],[2,"width","calc(min(450px,100%))","padding","0","margin-top","30px"],[2,"margin-top","20px","flex-direction","row","display","flex"],[2,"width","40px",3,"src","alt"],[2,"font-weight","bold","font-size","15px"],[1,"publication-created-at"],[2,"margin-bottom","20px"],[2,"margin-left","20px"],[1,"line"],["mat-subheader","",2,"color","#0000008a","font-weight","500"],[2,"padding-left","30px","padding-right","30px"],[2,"display","flex","flex-direction","row"],[1,"form",2,"flex-grow","1"],[2,"padding","8px 12px"],["cdkTextareaAutosize","","placeholder","Add a new comment here...",1,"comment-textarea",3,"id","ngModel","ngModelChange"],["mat-button","","color","primary",3,"id","click"],[2,"padding-bottom","15px"],["mat-subheader",""],["style","flex-direction: row; height: auto; max-width: 450px; margin-top: 5px;",4,"ngFor","ngForOf"],[2,"flex-direction","row","height","auto","max-width","450px","margin-top","5px"],[2,"position","relative","margin-right","10px","align-self","flex-start"],[2,"flex-direction","column"],[1,"comment"],[2,"font-weight","bold","font-size","12px"],[2,"flex-direction","row","display","flex"]],template:function(e,n){1&e&&(t._UZ(0,"app-navbar"),t.YNc(1,Z,1,0,"mat-progress-bar",0),t.TgZ(2,"div",1)(3,"mat-card",2)(4,"textarea",3),t.NdJ("ngModelChange",function(o){return n.publicationCreate.content=o}),t.qZA(),t.TgZ(5,"button",4),t.NdJ("click",function(){return n.addNewPublication()}),t._uU(6,"Add New Publication"),t.qZA()(),t.YNc(7,S,29,9,"mat-card",5),t.qZA()),2&e&&(t.xp6(1),t.Q6J("ngIf",!n.publicationsLoaded),t.xp6(3),t.Q6J("ngModel",n.publicationCreate.content),t.xp6(3),t.Q6J("ngForOf",n.publicationsData))},dependencies:[w.S,u.a8,u.dk,u.dn,u.n5,p.sg,p.O5,E.IC,m.Fj,m.JJ,m.On,C.lW,b.i$,b.Tg,b.gs,v.pW],styles:['.line-comments[_ngcontent-%COMP%]{border-bottom:1px solid darkgray;padding:20px 0;width:450px}.line[_ngcontent-%COMP%]{border-bottom:1px solid darkgray;margin:0 auto;width:93%}[placeholder][_ngcontent-%COMP%]:empty:before{content:attr(placeholder);color:#555}[placeholder][_ngcontent-%COMP%]:empty:focus:before{content:""}.comment-textarea[_ngcontent-%COMP%]{border-radius:20px;padding:10px;font-size:14px;font-family:Roboto,sans-serif;font-weight:300;background-color:#f0f2f5;outline:none;border:none;width:calc(100% - 20px);display:inline-block;overflow-y:hidden}.comment[_ngcontent-%COMP%]{display:inline-block;padding:10px;background-color:#f0f2f5;align-self:flex-start;outline:none;border:none;border-radius:20px;word-break:break-word;white-space:pre-line}.publication-created-at[_ngcontent-%COMP%]{font-size:12px;color:#888}[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#888;border-radius:20px}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#555}']}),i})();var T=a(6759),B=a(9549),N=a(284);const U=[{path:"",component:$}];let L=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[A.Bz.forChild(U),T.W,u.QW,p.ez,B.lN,N.c,m.u5,C.ot,b.ie,v.Cv]}),i})()}}]);