"use strict";(self.webpackChunkFullStackSocialApp=self.webpackChunkFullStackSocialApp||[]).push([[308],{9308:(S,C,o)=>{o.r(C),o.d(C,{MessagesModule:()=>D});var E=o(6424),d=o(5689),m=o(6895),e=o(1571),w=o(4961),A=o(529),k=o(2843),p=o(5625),_=o(262);let b=(()=>{class i{constructor(s){this.http=s,this.basePath="https://fullstacksocialapp-api-lenco.onrender.com/api/v1/messages",this.httpOptions={headers:new A.WM({"Content-Type":"application/json"})}}handleError(s){return s.error instanceof ErrorEvent?console.log(`An error occurred: ${s.error.message} `):console.error(`Backend returned code ${s.status}, body was: ${s.error}`),(0,k._)(()=>new Error("Something happened with request, please try again later"))}getAll(){return this.http.get(this.basePath,this.httpOptions).pipe((0,p.X)(2),(0,_.K)(this.handleError))}getByUserSenderIdAndUserReceiverId(s,r){return this.http.get(`${this.basePath}/userSenderId/${s}/userReceiverId/${r}`,this.httpOptions).pipe((0,p.X)(2),(0,_.K)(this.handleError))}create(s){return this.http.post(this.basePath,JSON.stringify(s),this.httpOptions).pipe((0,p.X)(2),(0,_.K)(this.handleError))}update(s,r){return this.http.put(`${this.basePath}/${s}`,JSON.stringify(r),this.httpOptions).pipe((0,p.X)(2),(0,_.K)(this.handleError))}}return i.\u0275fac=function(s){return new(s||i)(e.LFG(A.eN))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var O=o(9901),R=o(3546),T=o(4859),x=o(6338),a=o(4850),g=o(9349),t=o(433),n=o(3162);function l(i,c){1&i&&e._UZ(0,"mat-progress-bar",15)}function h(i,c){if(1&i){const s=e.EpF();e.TgZ(0,"div",16)(1,"button",17),e.NdJ("click",function(){const y=e.CHM(s).$implicit,Z=e.oxw();return e.KtG(Z.selectUser(y.id))}),e._UZ(2,"img",18),e.TgZ(3,"div",19)(4,"div"),e._uU(5),e.qZA()()()()}if(2&i){const s=c.$implicit,r=e.oxw();e.xp6(1),e.Tol(r.userSelected==s.id?"friend-selected":"friend-not-selected"),e.xp6(1),e.MGl("src","/assets/img/",s.avatar,".png",e.LSH),e.s9C("alt",s.avatar),e.xp6(3),e.Oqu(s.username)}}function u(i,c){1&i&&(e.TgZ(0,"div",24),e._uU(1,"Send the first message!"),e.qZA())}function v(i,c){if(1&i&&(e.TgZ(0,"mat-list-item",25)(1,"div")(2,"div")(3,"div"),e._uU(4),e.qZA()(),e.TgZ(5,"div",26)(6,"div",27),e._uU(7),e.qZA()()()()),2&i){const s=c.$implicit,r=e.oxw(2);e.xp6(1),e.Tol(s.userSenderid==r.userMe.id?"message-right":"message-left"),e.xp6(1),e.Tol(s.userSenderid==r.userMe.id?"comment-me":"comment-him"),e.xp6(2),e.Oqu(s.content),e.xp6(3),e.Oqu(s.createdAt)}}function M(i,c){if(1&i&&(e.TgZ(0,"mat-list",20)(1,"div",21),e._uU(2,"Messages"),e.qZA(),e.YNc(3,u,2,0,"div",22),e.YNc(4,v,8,6,"mat-list-item",23),e.qZA()),2&i){const s=e.oxw();e.xp6(3),e.Q6J("ngIf",0==s.messages.length),e.xp6(1),e.Q6J("ngForOf",s.messages)}}function P(i,c){1&i&&(e.TgZ(0,"div",24),e._uU(1,"Select a user first"),e.qZA())}function H(i,c){1&i&&(e.TgZ(0,"div"),e._UZ(1,"mat-divider"),e.qZA())}let I=(()=>{class i{constructor(s,r,f){this.elementRef=s,this.usersService=r,this.messagesService=f,this.usersLoaded=!1,this.userSelected=-1,this.userMe={},this.messages=[],this.message="",this.messageCreate={}}ngOnInit(){this.retrieveData(),this.socket=(0,d.ZP)("https://fullstacksocialappsocket-nodejs.onrender.com/"),this.socket.on("addNewMessage",s=>{-1!=this.userSelected&&(s.userSenderid==this.userMe.id||s.userReceiverid==this.userMe.id)&&this.selectUser(this.userSelected)})}retrieveData(){this.usersService.getUserByToken().subscribe({next:s=>{this.userMe=s,this.usersLoaded=!0}})}ngAfterViewInit(){this.elementRef.nativeElement.ownerDocument.body.style.backgroundColor="#e0ecf4",document.getElementById("input").addEventListener("keyup",s=>{s.preventDefault(),"Enter"==s.key&&!s.shiftKey&&document.getElementById("button").click()}),document.getElementById("input").addEventListener("keydown",s=>{"Enter"==s.key&&!s.shiftKey&&s.preventDefault()})}selectUser(s){this.userSelected=s,this.messagesService.getByUserSenderIdAndUserReceiverId(this.userMe.id,s).subscribe({next:r=>{this.messages=r.sort((f,y)=>f.id-y.id);for(let f of this.messages)f.createdAt=(0,m.p6)(f.createdAt,"MMMM d, 'at' h:mm a","en-US")}})}sendMessage(){this.message.length<=0||-1!==this.userSelected&&(this.messageCreate.userSenderid=this.userMe.id,this.messageCreate.userReceiverid=this.userSelected,this.messageCreate.content=this.message,this.messagesService.create(this.messageCreate).subscribe({next:s=>{this.message="",s.createdAt=(0,m.p6)(s.createdAt,"MMMM d, 'at' h:mm a","en-US"),this.messages.push(s),this.socket.emit("addNewMessage",{userSenderid:this.userMe.id,userReceiverid:this.userSelected})}}))}}return i.\u0275fac=function(s){return new(s||i)(e.Y36(e.SBq),e.Y36(w.f),e.Y36(b))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-messages"]],decls:18,vars:8,consts:[["mode","indeterminate",4,"ngIf"],[1,"card-messages",2,"background-color","#98ccdc"],[2,"display","flex"],[2,"width","150px"],["style","width: 150px; height: 50px; margin-left: -15px",4,"ngFor","ngForOf"],["vertical","",2,"height","450px"],[2,"width","min(350px, calc(100% - 150px))"],["class","messages",4,"ngIf"],["style","margin-left: 10px; color: #0000008a",4,"ngIf"],[4,"ngIf"],[2,"display","flex","flex-direction","row"],[1,"form",2,"flex-grow","1"],[2,"padding","8px 12px"],["id","input","cdkTextareaAutosize","","placeholder","Write a message...",1,"comment-textarea",3,"ngModel","ngModelChange"],["mat-button","","color","primary","id","button",3,"click"],["mode","indeterminate"],[2,"width","150px","height","50px","margin-left","-15px"],["mat-button","",2,"width","150px","flex-direction","row",3,"click"],[2,"width","40px",3,"src","alt"],[2,"display","inline-block","width","100px"],[1,"messages"],["mat-subheader",""],["style","margin-left: 10px; color: #0000008a;",4,"ngIf"],["style","flex-direction: row; width: 100%; margin-top: 5px; height: auto;",4,"ngFor","ngForOf"],[2,"margin-left","10px","color","#0000008a"],[2,"flex-direction","row","width","100%","margin-top","5px","height","auto"],[2,"flex-direction","row"],[1,"publication-created-at",2,"display","inline-block"]],template:function(s,r){1&s&&(e._UZ(0,"app-navbar"),e.YNc(1,l,1,0,"mat-progress-bar",0),e.TgZ(2,"mat-card",1)(3,"div",2)(4,"div",3),e.YNc(5,h,6,5,"div",4),e.qZA(),e._UZ(6,"mat-divider",5),e.TgZ(7,"div",6),e.YNc(8,M,5,2,"mat-list",7),e.YNc(9,P,2,0,"div",8),e.YNc(10,H,2,0,"div",9),e.TgZ(11,"div")(12,"div",10)(13,"div",11)(14,"div",12)(15,"textarea",13),e.NdJ("ngModelChange",function(y){return r.message=y}),e.qZA()()(),e.TgZ(16,"button",14),e.NdJ("click",function(){return r.sendMessage()}),e._uU(17,"Send"),e.qZA()()()()()()),2&s&&(e.xp6(1),e.Q6J("ngIf",!r.usersLoaded),e.xp6(4),e.Q6J("ngForOf",r.userMe.userFriends),e.xp6(3),e.Q6J("ngIf",-1!=r.userSelected),e.xp6(1),e.Q6J("ngIf",-1==r.userSelected),e.xp6(1),e.Q6J("ngIf",-1!=r.userSelected),e.xp6(1),e.Akn(-1==r.userSelected?"display: none":""),e.xp6(4),e.Q6J("ngModel",r.message))},dependencies:[O.S,R.a8,m.sg,m.O5,T.lW,x.i$,x.Tg,x.gs,a.d,g.IC,t.Fj,t.JJ,t.On,n.pW],styles:[".comment-me[_ngcontent-%COMP%]{display:inline-block;padding:10px;background-color:#1dcaff;align-self:flex-start;outline:none;border:none;border-radius:20px;word-break:break-word;white-space:pre-line}.comment-him[_ngcontent-%COMP%]{display:inline-block;padding:10px;background-color:#f0f2f5;align-self:flex-start;outline:none;border:none;border-radius:20px;word-break:break-word;white-space:pre-line}.message-left[_ngcontent-%COMP%]{flex-direction:column;width:300px}.message-right[_ngcontent-%COMP%]{flex-direction:column;width:300px;text-align:right}.publication-created-at[_ngcontent-%COMP%]{font-size:12px;color:#888}.line[_ngcontent-%COMP%]{border-bottom:1px solid darkgray;margin:0 auto;width:100%}.comment-textarea[_ngcontent-%COMP%]{max-height:50px;border-radius:20px;padding:10px;font-size:14px;font-family:Roboto,sans-serif;font-weight:300;background-color:#f0f2f5;outline:none;border:none;width:100%;display:inline-block;overflow-y:hidden}.card-messages[_ngcontent-%COMP%]{width:min(450px,calc(100% - 52px));min-width:200px;height:450px;margin:30px auto 0}.messages[_ngcontent-%COMP%]{padding-bottom:15px;height:360px;overflow-y:auto;overflow-x:hidden}.friend-selected[_ngcontent-%COMP%]{background-color:#2596be}[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#888;border-radius:20px}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#555}"]}),i})();var F=o(6759);const L=[{path:"",component:I}];let D=(()=>{class i{}return i.\u0275fac=function(s){return new(s||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[E.Bz.forChild(L),F.W,R.QW,m.ez,T.ot,x.ie,g.Ky,t.u5,n.Cv]}),i})()},9349:(S,C,o)=>{o.d(C,{IC:()=>T,Ky:()=>x,Lq:()=>O});var E=o(3353),d=o(1571),m=o(1281),e=o(515),w=o(7579),A=o(4968),k=o(3601),p=o(2722),_=o(6895);const b=(0,E.i$)({passive:!0});let O=(()=>{class a{constructor(t,n){this._platform=t,this._ngZone=n,this._monitoredElements=new Map}monitor(t){if(!this._platform.isBrowser)return e.E;const n=(0,m.fI)(t),l=this._monitoredElements.get(n);if(l)return l.subject;const h=new w.x,u="cdk-text-field-autofilled",v=M=>{"cdk-text-field-autofill-start"!==M.animationName||n.classList.contains(u)?"cdk-text-field-autofill-end"===M.animationName&&n.classList.contains(u)&&(n.classList.remove(u),this._ngZone.run(()=>h.next({target:M.target,isAutofilled:!1}))):(n.classList.add(u),this._ngZone.run(()=>h.next({target:M.target,isAutofilled:!0})))};return this._ngZone.runOutsideAngular(()=>{n.addEventListener("animationstart",v,b),n.classList.add("cdk-text-field-autofill-monitored")}),this._monitoredElements.set(n,{subject:h,unlisten:()=>{n.removeEventListener("animationstart",v,b)}}),h}stopMonitoring(t){const n=(0,m.fI)(t),l=this._monitoredElements.get(n);l&&(l.unlisten(),l.subject.complete(),n.classList.remove("cdk-text-field-autofill-monitored"),n.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(n))}ngOnDestroy(){this._monitoredElements.forEach((t,n)=>this.stopMonitoring(n))}}return a.\u0275fac=function(t){return new(t||a)(d.LFG(E.t4),d.LFG(d.R0b))},a.\u0275prov=d.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})(),T=(()=>{class a{constructor(t,n,l,h){this._elementRef=t,this._platform=n,this._ngZone=l,this._destroyed=new w.x,this._enabled=!0,this._previousMinRows=-1,this._isViewInited=!1,this._handleFocusEvent=u=>{this._hasFocus="focus"===u.type},this._document=h,this._textareaElement=this._elementRef.nativeElement}get minRows(){return this._minRows}set minRows(t){this._minRows=(0,m.su)(t),this._setMinHeight()}get maxRows(){return this._maxRows}set maxRows(t){this._maxRows=(0,m.su)(t),this._setMaxHeight()}get enabled(){return this._enabled}set enabled(t){t=(0,m.Ig)(t),this._enabled!==t&&((this._enabled=t)?this.resizeToFitContent(!0):this.reset())}get placeholder(){return this._textareaElement.placeholder}set placeholder(t){this._cachedPlaceholderHeight=void 0,t?this._textareaElement.setAttribute("placeholder",t):this._textareaElement.removeAttribute("placeholder"),this._cacheTextareaPlaceholderHeight()}_setMinHeight(){const t=this.minRows&&this._cachedLineHeight?this.minRows*this._cachedLineHeight+"px":null;t&&(this._textareaElement.style.minHeight=t)}_setMaxHeight(){const t=this.maxRows&&this._cachedLineHeight?this.maxRows*this._cachedLineHeight+"px":null;t&&(this._textareaElement.style.maxHeight=t)}ngAfterViewInit(){this._platform.isBrowser&&(this._initialHeight=this._textareaElement.style.height,this.resizeToFitContent(),this._ngZone.runOutsideAngular(()=>{const t=this._getWindow();(0,A.R)(t,"resize").pipe((0,k.e)(16),(0,p.R)(this._destroyed)).subscribe(()=>this.resizeToFitContent(!0)),this._textareaElement.addEventListener("focus",this._handleFocusEvent),this._textareaElement.addEventListener("blur",this._handleFocusEvent)}),this._isViewInited=!0,this.resizeToFitContent(!0))}ngOnDestroy(){this._textareaElement.removeEventListener("focus",this._handleFocusEvent),this._textareaElement.removeEventListener("blur",this._handleFocusEvent),this._destroyed.next(),this._destroyed.complete()}_cacheTextareaLineHeight(){if(this._cachedLineHeight)return;let t=this._textareaElement.cloneNode(!1);t.rows=1,t.style.position="absolute",t.style.visibility="hidden",t.style.border="none",t.style.padding="0",t.style.height="",t.style.minHeight="",t.style.maxHeight="",t.style.overflow="hidden",this._textareaElement.parentNode.appendChild(t),this._cachedLineHeight=t.clientHeight,t.remove(),this._setMinHeight(),this._setMaxHeight()}_measureScrollHeight(){const t=this._textareaElement,n=t.style.marginBottom||"",l=this._platform.FIREFOX,h=l&&this._hasFocus,u=l?"cdk-textarea-autosize-measuring-firefox":"cdk-textarea-autosize-measuring";h&&(t.style.marginBottom=`${t.clientHeight}px`),t.classList.add(u);const v=t.scrollHeight-4;return t.classList.remove(u),h&&(t.style.marginBottom=n),v}_cacheTextareaPlaceholderHeight(){if(!this._isViewInited||null!=this._cachedPlaceholderHeight)return;if(!this.placeholder)return void(this._cachedPlaceholderHeight=0);const t=this._textareaElement.value;this._textareaElement.value=this._textareaElement.placeholder,this._cachedPlaceholderHeight=this._measureScrollHeight(),this._textareaElement.value=t}ngDoCheck(){this._platform.isBrowser&&this.resizeToFitContent()}resizeToFitContent(t=!1){if(!this._enabled||(this._cacheTextareaLineHeight(),this._cacheTextareaPlaceholderHeight(),!this._cachedLineHeight))return;const n=this._elementRef.nativeElement,l=n.value;if(!t&&this._minRows===this._previousMinRows&&l===this._previousValue)return;const h=this._measureScrollHeight(),u=Math.max(h,this._cachedPlaceholderHeight||0);n.style.height=`${u}px`,this._ngZone.runOutsideAngular(()=>{typeof requestAnimationFrame<"u"?requestAnimationFrame(()=>this._scrollToCaretPosition(n)):setTimeout(()=>this._scrollToCaretPosition(n))}),this._previousValue=l,this._previousMinRows=this._minRows}reset(){void 0!==this._initialHeight&&(this._textareaElement.style.height=this._initialHeight)}_noopInputHandler(){}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_scrollToCaretPosition(t){const{selectionStart:n,selectionEnd:l}=t;!this._destroyed.isStopped&&this._hasFocus&&t.setSelectionRange(n,l)}}return a.\u0275fac=function(t){return new(t||a)(d.Y36(d.SBq),d.Y36(E.t4),d.Y36(d.R0b),d.Y36(_.K0,8))},a.\u0275dir=d.lG2({type:a,selectors:[["textarea","cdkTextareaAutosize",""]],hostAttrs:["rows","1",1,"cdk-textarea-autosize"],hostBindings:function(t,n){1&t&&d.NdJ("input",function(){return n._noopInputHandler()})},inputs:{minRows:["cdkAutosizeMinRows","minRows"],maxRows:["cdkAutosizeMaxRows","maxRows"],enabled:["cdkTextareaAutosize","enabled"],placeholder:"placeholder"},exportAs:["cdkTextareaAutosize"]}),a})(),x=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=d.oAB({type:a}),a.\u0275inj=d.cJS({}),a})()}}]);